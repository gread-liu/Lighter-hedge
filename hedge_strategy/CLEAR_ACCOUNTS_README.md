# è´¦æˆ·æ¸…ç©ºå·¥å…·ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½è¯´æ˜

[`clear_accounts.py`](clear_accounts.py) æ˜¯ä¸€ä¸ªä¸€é”®æ¸…ç©ºAã€Bä¸¤ä¸ªè´¦æˆ·çš„å·¥å…·ç¨‹åºï¼Œå¯ä»¥ï¼š

1. **å–æ¶ˆæ‰€æœ‰æ´»è·ƒè®¢å•** - æ¸…ç©ºè´¦æˆ·ä¸­æ‰€æœ‰æœªæˆäº¤çš„é™ä»·å•
2. **å¹³æ‰æ‰€æœ‰æŒä»“** - ä½¿ç”¨å¸‚ä»·å•å¹³æ‰è´¦æˆ·ä¸­çš„æ‰€æœ‰å¤šå¤´æˆ–ç©ºå¤´ä»“ä½
3. **æ”¯æŒå•ç‹¬æˆ–æ‰¹é‡æ“ä½œ** - å¯ä»¥é€‰æ‹©æ¸…ç©ºå•ä¸ªè´¦æˆ·æˆ–åŒæ—¶æ¸…ç©ºä¸¤ä¸ªè´¦æˆ·

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æ¸…ç©ºæ‰€æœ‰è´¦æˆ·ï¼ˆAå’ŒBï¼‰
cd hedge_strategy
python3 clear_accounts.py

# æˆ–æŒ‡å®šæ¸…ç©ºæ‰€æœ‰è´¦æˆ·
python3 clear_accounts.py --account all
```

### æ¸…ç©ºå•ä¸ªè´¦æˆ·

```bash
# åªæ¸…ç©ºAè´¦æˆ·
python3 clear_accounts.py --account a

# åªæ¸…ç©ºBè´¦æˆ·
python3 clear_accounts.py --account b
```

### æŒ‡å®šå¸‚åœº

```bash
# æ¸…ç©ºæŒ‡å®šå¸‚åœºçš„è®¢å•å’ŒæŒä»“ï¼ˆé»˜è®¤BTCï¼‰
python3 clear_accounts.py --market BTC

# æ¸…ç©ºETHå¸‚åœº
python3 clear_accounts.py --market ETH
```

### ç»„åˆä½¿ç”¨

```bash
# åªæ¸…ç©ºAè´¦æˆ·çš„ETHå¸‚åœº
python3 clear_accounts.py --account a --market ETH
```

## å‚æ•°è¯´æ˜

| å‚æ•° | å¯é€‰å€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| `--account` | `a`, `b`, `all` | `all` | è¦æ¸…ç©ºçš„è´¦æˆ· |
| `--market` | å¸‚åœºç¬¦å· | `BTC` | è¦æ¸…ç©ºçš„å¸‚åœº |

## æ‰§è¡Œæµç¨‹

### 1. æ¸…ç©ºå•ä¸ªè´¦æˆ·æµç¨‹

```
åˆå§‹åŒ–å®¢æˆ·ç«¯
    â†“
è·å–å¸‚åœºä¿¡æ¯
    â†“
æŸ¥è¯¢æ´»è·ƒè®¢å•
    â†“
é€ä¸ªå–æ¶ˆè®¢å•
    â†“
æŸ¥è¯¢æŒä»“æƒ…å†µ
    â†“
åˆ¤æ–­æŒä»“æ–¹å‘
    â†“
åˆ›å»ºå¸‚ä»·å•å¹³ä»“
    â†“
éªŒè¯å¹³ä»“ç»“æœ
```

### 2. æ¸…ç©ºæ‰€æœ‰è´¦æˆ·æµç¨‹

```
æ¸…ç©ºAè´¦æˆ·
    â†“
ç­‰å¾…1ç§’
    â†“
æ¸…ç©ºBè´¦æˆ·
    â†“
è¾“å‡ºæ±‡æ€»ç»“æœ
```

## è¾“å‡ºç¤ºä¾‹

### æˆåŠŸæ¸…ç©ºç¤ºä¾‹

```
############################################################
# å¼€å§‹æ¸…ç©ºaccount_aè´¦æˆ·
############################################################
âœ… account_aè´¦æˆ·å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ

============================================================
å¼€å§‹å–æ¶ˆaccount_aè´¦æˆ·çš„æ‰€æœ‰æ´»è·ƒè®¢å•...
============================================================
ğŸ“‹ æ‰¾åˆ° 3 ä¸ªæ´»è·ƒè®¢å•
âœ… å·²å–æ¶ˆè®¢å•: 844424550066612
âœ… å·²å–æ¶ˆè®¢å•: 562950327154264
âœ… å·²å–æ¶ˆè®¢å•: 562950327149650

âœ… account_aè´¦æˆ·è®¢å•å–æ¶ˆå®Œæˆ: 3/3

============================================================
å¼€å§‹å¹³æ‰account_aè´¦æˆ·çš„æ‰€æœ‰æŒä»“...
============================================================
ğŸ“Š å½“å‰æŒä»“: 0.0002
ğŸ“ æŒä»“ç±»å‹: å¤šå¤´, éœ€è¦å–å‡ºå¹³ä»“
ğŸ’° å¹³ä»“ä»·æ ¼: 109391.6, æ•°é‡: 0.0002
âœ… å¹³ä»“è®¢å•åˆ›å»ºæˆåŠŸ
ğŸ“ äº¤æ˜“å“ˆå¸Œ: 237d45de6973bf9f...
âœ… account_aè´¦æˆ·æŒä»“å·²æˆåŠŸå¹³æ‰

============================================================
âœ… account_aè´¦æˆ·æ¸…ç©ºå®Œæˆï¼
   - å–æ¶ˆè®¢å•: 3 ä¸ª
   - å¹³ä»“çŠ¶æ€: æˆåŠŸ
============================================================
```

### æ— è®¢å•å’ŒæŒä»“ç¤ºä¾‹

```
============================================================
å¼€å§‹å–æ¶ˆaccount_bè´¦æˆ·çš„æ‰€æœ‰æ´»è·ƒè®¢å•...
============================================================
âœ… account_bè´¦æˆ·æ²¡æœ‰æ´»è·ƒè®¢å•

============================================================
å¼€å§‹å¹³æ‰account_bè´¦æˆ·çš„æ‰€æœ‰æŒä»“...
============================================================
âœ… account_bè´¦æˆ·æ²¡æœ‰æŒä»“

============================================================
âœ… account_bè´¦æˆ·æ¸…ç©ºå®Œæˆï¼
   - å–æ¶ˆè®¢å•: 0 ä¸ª
   - å¹³ä»“çŠ¶æ€: æˆåŠŸ
============================================================
```

### æ±‡æ€»ç»“æœç¤ºä¾‹

```
############################################################
# æ¸…ç©ºç»“æœæ±‡æ€»
############################################################
Aè´¦æˆ·: âœ… æˆåŠŸ
Bè´¦æˆ·: âœ… æˆåŠŸ
############################################################
```

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **ä¸å¯é€†æ“ä½œ** - æ¸…ç©ºæ“ä½œä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•æ’¤é”€
2. **å¸‚ä»·å¹³ä»“** - å¹³ä»“ä½¿ç”¨å¸‚ä»·å•ï¼Œå¯èƒ½æœ‰æ»‘ç‚¹
3. **ç½‘ç»œå»¶è¿Ÿ** - æ‰§è¡Œè¿‡ç¨‹ä¸­è¯·ä¿æŒç½‘ç»œè¿æ¥ç¨³å®š
4. **ä½™é¢è¦æ±‚** - ç¡®ä¿è´¦æˆ·æœ‰è¶³å¤Ÿçš„gasè´¹ç”¨

### ğŸ”’ å®‰å…¨å»ºè®®

1. **å…ˆåœæ­¢ç­–ç•¥** - æ¸…ç©ºå‰å»ºè®®å…ˆåœæ­¢Aã€Bå…¥å£ç¨‹åº
2. **ç¡®è®¤è´¦æˆ·** - æ‰§è¡Œå‰ç¡®è®¤è¦æ¸…ç©ºçš„è´¦æˆ·
3. **æ£€æŸ¥ç»“æœ** - æ‰§è¡Œåæ£€æŸ¥æ—¥å¿—ç¡®è®¤æ¸…ç©ºæˆåŠŸ
4. **å¤‡ä»½é…ç½®** - é‡è¦é…ç½®æ–‡ä»¶å»ºè®®å¤‡ä»½

## åœæ­¢ç­–ç•¥åæ¸…ç©º

### æ¨èæµç¨‹

```bash
# 1. åœæ­¢Aå’ŒBå…¥å£
cd hedge_strategy
./stop_hedge.sh

# 2. ç­‰å¾…è¿›ç¨‹å®Œå…¨åœæ­¢
sleep 2

# 3. æ¸…ç©ºæ‰€æœ‰è´¦æˆ·
python3 clear_accounts.py

# 4. æŸ¥çœ‹æ¸…ç©ºç»“æœ
# æ£€æŸ¥æ—¥å¿—è¾“å‡ºç¡®è®¤æ¸…ç©ºæˆåŠŸ
```

## å¸¸è§é—®é¢˜

### Q1: æ¸…ç©ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—å®šä½é—®é¢˜

### Q2: éƒ¨åˆ†è®¢å•å–æ¶ˆå¤±è´¥ï¼Ÿ

**A:** å¯èƒ½åŸå› ï¼š
- è®¢å•å·²ç»æˆäº¤
- è®¢å•å·²è¿‡æœŸ
- ç½‘ç»œè¶…æ—¶

å»ºè®®é‡æ–°è¿è¡Œæ¸…ç©ºç¨‹åºã€‚

### Q3: æŒä»“æœªå®Œå…¨å¹³æ‰ï¼Ÿ

**A:** å¯èƒ½åŸå› ï¼š
- å¸‚åœºæµåŠ¨æ€§ä¸è¶³
- ä»·æ ¼æ³¢åŠ¨è¿‡å¤§
- è®¢å•éƒ¨åˆ†æˆäº¤

å»ºè®®ï¼š
1. æŸ¥çœ‹æ—¥å¿—ä¸­çš„å‰©ä½™æŒä»“
2. æ‰‹åŠ¨å¹³æ‰å‰©ä½™ä»“ä½
3. æˆ–å†æ¬¡è¿è¡Œæ¸…ç©ºç¨‹åº

### Q4: å¯ä»¥åœ¨ç­–ç•¥è¿è¡Œæ—¶æ¸…ç©ºå—ï¼Ÿ

**A:** ä¸å»ºè®®ã€‚åŸå› ï¼š
- ç­–ç•¥å¯èƒ½ç»§ç»­åˆ›å»ºæ–°è®¢å•
- å¯èƒ½å¯¼è‡´è´¦æˆ·çŠ¶æ€ä¸ä¸€è‡´
- å»ºè®®å…ˆåœæ­¢ç­–ç•¥å†æ¸…ç©º

## æŠ€æœ¯ç»†èŠ‚

### å¹³ä»“é€»è¾‘

```python
# å¤šå¤´æŒä»“ â†’ å–å‡ºå¹³ä»“
if position_size > 0:
    is_ask = True  # å–å‡º
    
# ç©ºå¤´æŒä»“ â†’ ä¹°å…¥å¹³ä»“
else:
    is_ask = False  # ä¹°å…¥
    position_size = abs(position_size)
```

### å¸‚ä»·å•å‚æ•°

```python
await client.create_market_order(
    market_index=market_index,
    client_order_index=0,
    base_amount=base_amount,
    avg_execution_price=avg_execution_price,
    is_ask=is_ask,
    reduce_only=True  # åªå‡ä»“ï¼Œä¸å¼€æ–°ä»“
)
```

## ç›¸å…³æ–‡ä»¶

- [`clear_accounts.py`](clear_accounts.py) - æ¸…ç©ºå·¥å…·ä¸»ç¨‹åº
- [`config.yaml`](config.yaml) - è´¦æˆ·é…ç½®æ–‡ä»¶
- [`stop_hedge.sh`](stop_hedge.sh) - åœæ­¢ç­–ç•¥è„šæœ¬

## æ—¥å¿—çº§åˆ«

ç¨‹åºä½¿ç”¨INFOçº§åˆ«æ—¥å¿—ï¼Œè¾“å‡ºåŒ…æ‹¬ï¼š
- âœ… æˆåŠŸæ“ä½œ
- âŒ å¤±è´¥æ“ä½œ
- âš ï¸ è­¦å‘Šä¿¡æ¯
- ğŸ“‹ ç»Ÿè®¡ä¿¡æ¯
- ğŸ“ çŠ¶æ€ä¿¡æ¯
- ğŸ’° ä»·æ ¼ä¿¡æ¯

## ç¤ºä¾‹è„šæœ¬

### å®Œæ•´æ¸…ç©ºæµç¨‹

```bash
#!/bin/bash
# å®Œæ•´æ¸…ç©ºAã€Bè´¦æˆ·çš„è„šæœ¬

echo "=== å¼€å§‹æ¸…ç©ºè´¦æˆ·æµç¨‹ ==="

# 1. åœæ­¢ç­–ç•¥
echo "1. åœæ­¢Aå’ŒBå…¥å£..."
cd hedge_strategy
./stop_hedge.sh
sleep 3

# 2. æ¸…ç©ºè´¦æˆ·
echo "2. æ¸…ç©ºæ‰€æœ‰è´¦æˆ·..."
python3 clear_accounts.py --account all --market BTC

# 3. éªŒè¯ç»“æœ
echo "3. æ¸…ç©ºå®Œæˆï¼"
echo "è¯·æ£€æŸ¥ä¸Šæ–¹æ—¥å¿—ç¡®è®¤æ¸…ç©ºæˆåŠŸ"
```

## æ›´æ–°æ—¥å¿—

- **v1.0.0** (2025-10-23)
  - åˆå§‹ç‰ˆæœ¬
  - æ”¯æŒå–æ¶ˆè®¢å•å’Œå¹³ä»“
  - æ”¯æŒå•ç‹¬æˆ–æ‰¹é‡æ¸…ç©ºè´¦æˆ·

---

**æœ€åæ›´æ–°**: 2025-10-23
**ç‰ˆæœ¬**: v1.0.0